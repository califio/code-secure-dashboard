import{a as x,b as s,c as I}from"./chunk-23W66GLT.js";import{a as _}from"./chunk-2AZPC3K3.js";import{da as j}from"./chunk-G46RF4U2.js";import{a as M}from"./chunk-QXA7VEUO.js";import{a as E}from"./chunk-ENGL65RD.js";import{a as h,b,d as w,l as C,q as y,r as T}from"./chunk-5ASYMZAG.js";import{e as A}from"./chunk-FHVUNOKG.js";import{H as d,Ib as o,Qb as S,R as P,Sa as r,Ta as u,Za as F,ba as v,db as D,fb as l,kb as V,p as k,pb as t,qb as i,rb as m,v as J,wb as p}from"./chunk-LUMD5QXA.js";function z(c,B){c&1&&m(0,"ng-icon",11)}var $=(()=>{class c{integrationService;formService;toastr;formConfig=new x({active:new s(!0),webUrl:new s(""),userName:new s(""),password:new s(""),projectKey:new s(""),issueType:new s("")});form;jiraProjects=F([]);issueTypes=F([]);loadingJiraProject=!1;loadingIssueType=!1;loadingTest=!1;constructor(a,n,e){this.integrationService=a,this.formService=n,this.toastr=e,this.form=this.formService.group(this.formConfig)}ngOnInit(){J([this.loadJiraProject(),this.integrationService.getJiraIntegrationSetting()]).subscribe(a=>{let n=a[1];n.projectKey&&this.loadIssueType(n.projectKey).pipe(d(()=>{this.form.patchValue(n)})).subscribe(e=>{this.issueTypes.set(e)})})}onChangeProject(a){this.form.controls.projectKey.setValue(a),this.loadIssueType(a).subscribe(n=>{this.issueTypes.set(n)})}onChangeIssueType(a){this.form.controls.issueType.setValue(a)}loadIssueType(a){return this.loadingIssueType=!0,this.integrationService.getJiraIssueTypes({projectKey:a}).pipe(d(()=>this.loadingIssueType=!1),k(n=>n.map(e=>({value:e,label:e}))))}onReload(){this.form.controls.password.value?this.loadJiraProject(!0,this.form.getRawValue()).subscribe():this.loadJiraProject(!0).subscribe()}loadJiraProject(a=!1,n=void 0){return this.loadingJiraProject=!0,this.integrationService.getJiraProjects({reload:a,body:n}).pipe(d(()=>this.loadingJiraProject=!1),P(e=>{let f=e.map(g=>({label:g.name,value:g.key}));this.jiraProjects.set(f)}))}saveSetting(){this.form.disable(),this.integrationService.updateJiraIntegrationSetting({body:this.form.getRawValue()}).pipe(d(()=>this.form.enable())).subscribe(()=>{this.toastr.success("Update success!")})}testConnection(){this.loadingTest=!0,this.integrationService.testJiraIntegrationSetting().pipe(d(()=>this.loadingTest=!1)).subscribe(()=>{this.toastr.success("Success!")})}static \u0275fac=function(n){return new(n||c)(u(_),u(I),u(j))};static \u0275cmp=v({type:c,selectors:[["app-jira"]],standalone:!0,features:[S],decls:43,vars:15,consts:[[1,"flex","flex-col","rounded-xl","bg-background","gap-4","w-full"],[1,"flex","flex-col","gap-2","w-full"],[1,"flex","flex-row","gap-2","w-full","items-center"],[1,"w-36","md:w-48"],[1,"w-full","max-w-md"],["type","checkbox",3,"formControl"],["type","text",1,"w-full",3,"formControl"],[1,"flex","flex-row","items-center","gap-2"],[3,"selectedChange","options","showLabel","selected"],["dropdown-label","",1,"font-semibold","text-xs"],["app-button","","type","default",1,"px-4","py-2",3,"click","loading"],["name","arrowPath",1,"text-sm"],[3,"selectedChange","options","showLabel","loading","selected"],[1,"flex","flex-row","gap-2","items-center"],["app-button","","type","primary",1,"w-fit",3,"click","loading"]],template:function(n,e){n&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),o(4,"Enable"),i(),t(5,"div",4),m(6,"input",5),i()(),t(7,"div",2)(8,"span",3),o(9,"Jira URL"),i(),t(10,"div",4),m(11,"input",6),i()(),t(12,"div",2)(13,"span",3),o(14,"Email or username"),i(),t(15,"div",4),m(16,"input",6),i()(),t(17,"div",2)(18,"span",3),o(19,"API token or password"),i(),t(20,"div",4),m(21,"input",6),i()(),t(22,"div",2)(23,"span",3),o(24,"Default Project"),i(),t(25,"div",7)(26,"dropdown",8),p("selectedChange",function(g){return e.onChangeProject(g)}),t(27,"span",9),o(28,"Select"),i()(),t(29,"button",10),p("click",function(){return e.onReload()}),D(30,z,1,0,"ng-icon",11),i()()(),t(31,"div",2)(32,"span",3),o(33,"Issue Type"),i(),t(34,"div",7)(35,"dropdown",12),p("selectedChange",function(g){return e.onChangeIssueType(g)}),t(36,"span",9),o(37,"Select"),i()()()()(),t(38,"div",13)(39,"button",14),p("click",function(){return e.saveSetting()}),o(40,"Update"),i(),t(41,"button",14),p("click",function(){return e.testConnection()}),o(42,"Test Connection"),i()()()),n&2&&(r(6),l("formControl",e.form.controls.active),r(5),l("formControl",e.form.controls.webUrl),r(5),l("formControl",e.form.controls.userName),r(5),l("formControl",e.form.controls.password),r(5),l("options",e.jiraProjects())("showLabel",!1)("selected",e.form.controls.projectKey.value),r(3),l("loading",e.loadingJiraProject),r(),V(e.loadingJiraProject?-1:30),r(5),l("options",e.issueTypes())("showLabel",!1)("loading",e.loadingIssueType)("selected",e.form.controls.issueType.value),r(4),l("loading",e.form.disabled),r(2),l("loading",e.loadingTest))},dependencies:[E,y,b,h,w,M,A,T,C]})}return c})();var re=(()=>{class c{formService;integrationService;toastr;formConfig=new x({webhook:new s(""),active:new s(!0),scanCompletedEvent:new s(!1),scanFailedEvent:new s(!1),securityAlertEvent:new s(!0),fixedFindingEvent:new s(!0),newFindingEvent:new s(!0)});form;loadingTest=!1;constructor(a,n,e){this.formService=a,this.integrationService=n,this.toastr=e,this.form=this.formService.group(this.formConfig)}ngOnInit(){this.integrationService.getTeamsIntegrationSetting().subscribe(a=>{this.form.patchValue(a)})}saveConfig(){this.form.disable(),this.integrationService.updateTeamsIntegrationSetting({body:this.form.getRawValue()}).pipe(d(()=>this.form.enable())).subscribe(()=>{this.toastr.success("Update config success!")})}testConnection(){this.loadingTest=!0,this.integrationService.testTeamsIntegrationSetting().pipe(d(()=>this.loadingTest=!1)).subscribe(()=>{this.toastr.success("Send notification success")})}static \u0275fac=function(n){return new(n||c)(u(I),u(_),u(j))};static \u0275cmp=v({type:c,selectors:[["app-teams"]],standalone:!0,features:[S],decls:41,vars:11,consts:[[1,"flex","flex-col","rounded-xl","bg-background","gap-4","w-full"],[1,"flex","flex-col","gap-2","w-full"],[1,"flex","flex-row","gap-2","w-full","items-center"],[1,"w-36","md:w-48"],[1,"w-full","max-w-md"],["type","checkbox",3,"formControl"],["type","text",1,"w-full",3,"formControl"],[1,"flex","flex-row","gap-2","w-full"],[1,"flex","flex-col","gap-1"],[1,"flex","flex-row","gap-2","items-center"],["app-button","","type","primary",1,"w-fit",3,"click","loading","disabled"]],template:function(n,e){n&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),o(4,"Enable"),i(),t(5,"div",4),m(6,"input",5),i()(),t(7,"div",2)(8,"span",3),o(9,"Webhook"),i(),t(10,"div",4),m(11,"input",6),i()(),t(12,"div",7)(13,"span",3),o(14,"Event"),i(),t(15,"div",8)(16,"div",9),m(17,"input",5),t(18,"label"),o(19,"Scan Completed"),i()(),t(20,"div",9),m(21,"input",5),t(22,"label"),o(23,"Scan Failed"),i()(),t(24,"div",9),m(25,"input",5),t(26,"label"),o(27,"Security Alert"),i()(),t(28,"div",9),m(29,"input",5),t(30,"label"),o(31,"New Finding"),i()(),t(32,"div",9),m(33,"input",5),t(34,"label"),o(35,"Fixed Finding"),i()()()()(),t(36,"div",9)(37,"button",10),p("click",function(){return e.saveConfig()}),o(38,"Update"),i(),t(39,"button",10),p("click",function(){return e.testConnection()}),o(40,"Test Connection"),i()()()),n&2&&(r(6),l("formControl",e.form.controls.active),r(5),l("formControl",e.form.controls.webhook),r(6),l("formControl",e.form.controls.scanCompletedEvent),r(4),l("formControl",e.form.controls.scanFailedEvent),r(4),l("formControl",e.form.controls.securityAlertEvent),r(4),l("formControl",e.form.controls.newFindingEvent),r(4),l("formControl",e.form.controls.fixedFindingEvent),r(4),l("loading",e.form.disabled)("disabled",e.form.disabled),r(2),l("loading",e.loadingTest)("disabled",e.loadingTest))},dependencies:[E,y,b,h,w,T,C]})}return c})();export{$ as a,re as b};
