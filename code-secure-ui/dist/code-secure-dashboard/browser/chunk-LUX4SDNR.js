import{a as y,b as d,c as E}from"./chunk-23W66GLT.js";import"./chunk-PJ57YFKH.js";import{a as O}from"./chunk-2AZPC3K3.js";import"./chunk-7JDTD5PV.js";import{da as _}from"./chunk-G46RF4U2.js";import{a as C}from"./chunk-YHE4N465.js";import{a as K}from"./chunk-QXA7VEUO.js";import{a as b}from"./chunk-ENGL65RD.js";import{a as x}from"./chunk-W4N5Z7QK.js";import"./chunk-32FVIJUL.js";import{g as U}from"./chunk-2IXFTJ2H.js";import{a as P,b as B,d as J,l as M,q as V,r as w}from"./chunk-5ASYMZAG.js";import"./chunk-T2ZIFUV5.js";import"./chunk-KENT5INO.js";import{e as k}from"./chunk-FHVUNOKG.js";import"./chunk-3OH2LOAZ.js";import{H as u,Ib as r,Qb as j,Sa as l,Ta as c,Za as D,ba as S,db as v,fb as m,kb as g,la as T,ma as F,p as N,pb as e,qb as i,rb as s,tb as L,wb as f,xb as I}from"./chunk-LUMD5QXA.js";import"./chunk-AIZVJUQQ.js";function Y(a,h){a&1&&s(0,"ng-icon",10)}function Z(a,h){if(a&1){let n=L();e(0,"div",1)(1,"div",4)(2,"span",5),r(3,"Default Project"),i(),e(4,"div",6)(5,"dropdown",7),f("selectedChange",function(t){T(n);let p=I();return F(p.onChangeProject(t))}),e(6,"span",8),r(7,"Select"),i()(),e(8,"button",9),f("click",function(){T(n);let t=I();return F(t.onReload())}),v(9,Y,1,0,"ng-icon",10),i()()(),e(10,"div",4)(11,"span",5),r(12,"Issue Type"),i(),e(13,"div",6)(14,"dropdown",11),f("selectedChange",function(t){T(n);let p=I();return F(p.onChangeIssueType(t))}),e(15,"span",8),r(16,"Select"),i()()()()()}if(a&2){let n=I();l(5),m("options",n.jiraProjects())("showLabel",!1)("selected",n.form.controls.projectKey.value),l(3),m("loading",n.loading),l(),g(n.loading?-1:9),l(5),m("options",n.issueTypes())("showLabel",!1)("loading",n.loadingIssueType)("selected",n.form.controls.issueType.value)}}function $(a,h){a&1&&(e(0,"div"),r(1,"Not yet integrated with Jira. Go to "),e(2,"a",12),r(3,"Setting > Integration"),i(),r(4," to configure Jira first."),i())}var q=(()=>{class a{projectStore;projectService;integrationService;formService;toastr;jiraProjects=D([]);issueTypes=D([]);formConfig=new y({active:new d(!1),projectKey:new d(""),issueType:new d("")});form;loading=!1;loadingIssueType=!1;constructor(n,o,t,p,X){this.projectStore=n,this.projectService=o,this.integrationService=t,this.formService=p,this.toastr=X,this.form=this.formService.group(this.formConfig),this.form.controls.active.setValue(this.projectStore.projectSetting().jiraSetting?.active)}ngOnInit(){this.getJiraSetting().subscribe(n=>{this.jiraProjects.set(n.jiraProjects.map(o=>({value:o.key,label:o.name}))),this.loadIssueType(n.projectKey).subscribe(o=>{this.issueTypes.set(o),this.form.patchValue(n)})})}onReload(){this.getJiraSetting(!0).subscribe(n=>{this.jiraProjects.set(n.jiraProjects.map(o=>({value:o.key,label:o.name})))})}loadIssueType(n){return this.loadingIssueType=!0,this.integrationService.getJiraIssueTypes({projectKey:n}).pipe(u(()=>this.loadingIssueType=!1),N(o=>o.map(t=>({value:t,label:t}))))}saveJiraSetting(){this.form.disable(),this.projectService.updateJiraIntegrationProject({projectId:this.projectStore.projectId(),body:this.form.getRawValue()}).pipe(u(()=>this.form.enable())).subscribe(()=>{this.toastr.success("Update success!")})}getJiraSetting(n=!1){return this.loading=!0,this.projectService.getJiraIntegrationProject({projectId:this.projectStore.projectId(),reload:n}).pipe(u(()=>{this.loading=!1}))}onChangeProject(n){this.form.controls.projectKey.setValue(n),this.loadIssueType(n).subscribe(o=>{this.issueTypes.set(o)})}onChangeIssueType(n){this.form.controls.issueType.setValue(n)}static \u0275fac=function(o){return new(o||a)(c(C),c(x),c(O),c(E),c(_))};static \u0275cmp=S({type:a,selectors:[["jira-integration-project"]],standalone:!0,features:[j],decls:6,vars:2,consts:[[1,"flex","flex-col","rounded-xl","bg-background","gap-4","w-full"],[1,"flex","flex-col","gap-2","w-full"],[1,"flex","flex-row","gap-2","items-center"],["app-button","","type","primary",1,"w-fit",3,"click","loading"],[1,"flex","flex-row","gap-2","w-full","items-center"],[1,"w-36","md:w-48"],[1,"flex","flex-row","items-center","gap-2"],[3,"selectedChange","options","showLabel","selected"],["dropdown-label","",1,"font-semibold","text-xs"],["app-button","","type","default",3,"click","loading"],["name","arrowPath"],[3,"selectedChange","options","showLabel","loading","selected"],["routerLink","/setting/integration",1,"font-semibold","text-primary"]],template:function(o,t){o&1&&(e(0,"div",0),v(1,Z,17,9,"div",1)(2,$,5,0,"div"),e(3,"div",2)(4,"button",3),f("click",function(){return t.saveJiraSetting()}),r(5,"Update"),i()()()),o&2&&(l(),g(t.form.controls.active.value?1:2),l(3),m("loading",t.form.disabled))},dependencies:[b,w,K,k,U]})}return a})();var H=(()=>{class a{projectService;formService;projectStore;toastr;formConfig=new y({webhook:new d(""),active:new d(!1),scanCompletedEvent:new d(!1),scanFailedEvent:new d(!1),securityAlertEvent:new d(!1),fixedFindingEvent:new d(!1),newFindingEvent:new d(!1)});form;loadingTest=!1;constructor(n,o,t,p){this.projectService=n,this.formService=o,this.projectStore=t,this.toastr=p,this.form=this.formService.group(this.formConfig)}ngOnInit(){this.projectService.getTeamsIntegrationProject({projectId:this.projectStore.projectId()}).subscribe(n=>{this.form.patchValue(n)})}saveConfig(){this.form.disable(),this.projectService.updateTeamsIntegrationProject({projectId:this.projectStore.projectId(),body:this.form.getRawValue()}).pipe(u(()=>this.form.enable())).subscribe(()=>{this.toastr.success("Update success!")})}testAlert(){this.loadingTest=!0,this.projectService.testTeamsIntegrationProject({projectId:this.projectStore.projectId()}).pipe(u(()=>this.loadingTest=!1)).subscribe(()=>{this.toastr.success("Sent test alert!")})}static \u0275fac=function(o){return new(o||a)(c(x),c(E),c(C),c(_))};static \u0275cmp=S({type:a,selectors:[["teams-integration-project"]],standalone:!0,features:[j],decls:41,vars:11,consts:[[1,"flex","flex-col","rounded-xl","bg-background","gap-4","w-full"],[1,"flex","flex-col","gap-2","w-full"],[1,"flex","flex-row","gap-2","w-full","items-center"],[1,"w-36","md:w-48"],[1,"w-full","max-w-md"],["type","checkbox",3,"formControl"],["type","text",1,"w-full",3,"formControl"],[1,"flex","flex-row","gap-2","w-full"],[1,"flex","flex-col","gap-1"],[1,"flex","flex-row","gap-2","items-center"],["app-button","","type","primary",1,"w-fit",3,"click","loading","disabled"]],template:function(o,t){o&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),r(4,"Enable"),i(),e(5,"div",4),s(6,"input",5),i()(),e(7,"div",2)(8,"span",3),r(9,"Webhook"),i(),e(10,"div",4),s(11,"input",6),i()(),e(12,"div",7)(13,"span",3),r(14,"Event"),i(),e(15,"div",8)(16,"div",9),s(17,"input",5),e(18,"label"),r(19,"Scan Completed"),i()(),e(20,"div",9),s(21,"input",5),e(22,"label"),r(23,"Scan Failed"),i()(),e(24,"div",9),s(25,"input",5),e(26,"label"),r(27,"Security Alert"),i()(),e(28,"div",9),s(29,"input",5),e(30,"label"),r(31,"New Finding"),i()(),e(32,"div",9),s(33,"input",5),e(34,"label"),r(35,"Fixed Finding"),i()()()()(),e(36,"div",9)(37,"button",10),f("click",function(){return t.saveConfig()}),r(38,"Update"),i(),e(39,"button",10),f("click",function(){return t.testAlert()}),r(40,"Test Alert"),i()()()),o&2&&(l(6),m("formControl",t.form.controls.active),l(5),m("formControl",t.form.controls.webhook),l(6),m("formControl",t.form.controls.scanCompletedEvent),l(4),m("formControl",t.form.controls.scanFailedEvent),l(4),m("formControl",t.form.controls.securityAlertEvent),l(4),m("formControl",t.form.controls.newFindingEvent),l(4),m("formControl",t.form.controls.fixedFindingEvent),l(4),m("loading",t.form.disabled)("disabled",t.form.disabled),l(2),m("loading",t.loadingTest)("disabled",t.loadingTest))},dependencies:[b,V,B,P,J,w,M]})}return a})();var Q=(()=>{class a{formService;projectService;projectStore;toastr;formConfig=new y({active:new d(!0),scanCompletedEvent:new d(!1),scanFailedEvent:new d(!1),securityAlertEvent:new d(!1),fixedFindingEvent:new d(!1),newFindingEvent:new d(!1)});form;constructor(n,o,t,p){this.formService=n,this.projectService=o,this.projectStore=t,this.toastr=p,this.form=this.formService.group(this.formConfig)}ngOnInit(){this.projectService.getMailIntegrationProject({projectId:this.projectStore.projectId()}).subscribe(n=>{this.form.patchValue(n)})}saveConfig(){this.form.disable(),this.projectService.updateMailIntegrationProject({projectId:this.projectStore.projectId(),body:this.form.getRawValue()}).pipe(u(()=>this.form.enable())).subscribe(()=>{this.toastr.success("Update success!")})}static \u0275fac=function(o){return new(o||a)(c(E),c(x),c(C),c(_))};static \u0275cmp=S({type:a,selectors:[["mail-integration-project"]],standalone:!0,features:[j],decls:29,vars:7,consts:[[1,"flex","flex-col","rounded-xl","bg-background","gap-4","w-full"],[1,"flex","flex-col","gap-2","w-full"],[1,"flex","flex-row","gap-2","w-full"],[1,"w-36","md:w-48"],[1,"flex","flex-col","gap-1"],[1,"flex","flex-row","gap-2","items-center"],["type","checkbox",3,"formControl"],["app-button","","type","primary",1,"w-fit",3,"click","loading","disabled"]],template:function(o,t){o&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),r(4,"Event"),i(),e(5,"div",4)(6,"div",5),s(7,"input",6),e(8,"label"),r(9,"Scan Completed"),i()(),e(10,"div",5),s(11,"input",6),e(12,"label"),r(13,"Scan Failed"),i()(),e(14,"div",5),s(15,"input",6),e(16,"label"),r(17,"Security Alert"),i()(),e(18,"div",5),s(19,"input",6),e(20,"label"),r(21,"New Finding"),i()(),e(22,"div",5),s(23,"input",6),e(24,"label"),r(25,"Fixed Finding"),i()()()()(),e(26,"div",5)(27,"button",7),f("click",function(){return t.saveConfig()}),r(28,"Update"),i()()()),o&2&&(l(7),m("formControl",t.form.controls.scanCompletedEvent),l(4),m("formControl",t.form.controls.scanFailedEvent),l(4),m("formControl",t.form.controls.securityAlertEvent),l(4),m("formControl",t.form.controls.newFindingEvent),l(4),m("formControl",t.form.controls.fixedFindingEvent),l(4),m("loading",t.form.disabled)("disabled",t.form.disabled))},dependencies:[b,V,P,J,w,M]})}return a})();function te(a,h){a&1&&s(0,"mail-integration-project",18)}function ie(a,h){a&1&&(e(0,"div",14),s(1,"ng-icon",22),e(2,"span"),r(3,"Active"),i()())}function ne(a,h){a&1&&s(0,"teams-integration-project",18)}function oe(a,h){a&1&&(e(0,"div",14),s(1,"ng-icon",22),e(2,"span"),r(3,"Active"),i()())}function re(a,h){a&1&&s(0,"jira-integration-project",18)}var Re=(()=>{class a{projectService;projectStore;integrationSetting={};config={mail:!1,teams:!1,jira:!1};constructor(n,o){this.projectService=n,this.projectStore=o,this.projectService.getIntegrationProject({projectId:o.projectId()}).subscribe(t=>{this.integrationSetting=t})}static \u0275fac=function(o){return new(o||a)(c(x),c(C))};static \u0275cmp=S({type:a,selectors:[["app-integration"]],standalone:!0,features:[j],decls:59,vars:5,consts:[[1,"mx-auto","flex","flex-col","text-sm"],[1,"font-semibold","text-foreground","mb-2","ml-1","text-xl"],[1,"flex","flex-col","rounded-xl","border","border-border","bg-background","gap-4","p-4","w-full"],[1,"overflow-x-auto"],[1,"flex","flex-col","w-full"],[1,"flex","flex-col","border-b","border-border","p-2","gap-2"],[1,"flex","flex-row","gap-2"],[1,"w-full"],[1,"flex","flex-row","gap-2","items-center"],[1,"flex","flex-row","border","border-border","w-10","h-10","rounded","items-center","justify-center"],["name","heroEnvelope","size","28"],[1,"flex","flex-col"],[1,"flex","flex-row","items-center","gap-2"],[1,"font-semibold"],[1,"flex","flex-row","items-center","gap-1","rounded-full","px-1.5","py-0.5","text-xs","bg-green-100","text-green-800","dark:bg-green-900","dark:text-green-300"],[1,"hidden","md:block"],[1,"w-fit"],["app-button","","type","default",1,"w-fit",3,"click"],[1,"ml-12","mt-4"],["name","teams","size","28"],[1,"border","border-border","w-10","h-10","rounded","text-center"],["name","jira","size","36"],["name","heroCheckCircle","size","18"]],template:function(o,t){o&1&&(e(0,"div",0)(1,"div",1),r(2,"Integrations"),i(),e(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9),s(11,"ng-icon",10),i(),e(12,"div",11)(13,"div",12)(14,"div",13),r(15,"Mail"),i(),e(16,"div",14)(17,"span"),r(18,"Default"),i()()(),e(19,"div",15),r(20,"Send mail alert to project's members."),i()()()(),e(21,"div",16)(22,"button",17),f("click",function(){return t.config.mail=!t.config.mail}),r(23," Configure "),i()()(),v(24,te,1,0,"mail-integration-project",18),i(),e(25,"div",5)(26,"div",6)(27,"div",7)(28,"div",8)(29,"div",9),s(30,"ng-icon",19),i(),e(31,"div",11)(32,"div",12)(33,"div",13),r(34,"Microsoft Teams"),i(),v(35,ie,4,0,"div",14),i(),e(36,"div",15),r(37,"Send project's notifications to Microsoft Teams channels."),i()()()(),e(38,"div",16)(39,"button",17),f("click",function(){return t.config.teams=!t.config.teams}),r(40," Configure "),i()()(),v(41,ne,1,0,"teams-integration-project",18),i(),e(42,"div",5)(43,"div",6)(44,"div",7)(45,"div",8)(46,"div",20),s(47,"ng-icon",21),i(),e(48,"div",11)(49,"div",12)(50,"div",13),r(51,"Jira Issues"),i(),v(52,oe,4,0,"div",14),i(),e(53,"div"),r(54,"Push project's issues to Jira."),i()()()(),e(55,"div",16)(56,"button",17),f("click",function(){return t.config.jira=!t.config.jira}),r(57," Configure "),i()()(),v(58,re,1,0,"jira-integration-project",18),i()()()()()),o&2&&(l(24),g(t.config.mail?24:-1),l(11),g(t.integrationSetting.teams?35:-1),l(6),g(t.config.teams?41:-1),l(11),g(t.integrationSetting.jira?52:-1),l(6),g(t.config.jira?58:-1))},dependencies:[b,k,H,q,Q]})}return a})();export{Re as IntegrationComponent};
