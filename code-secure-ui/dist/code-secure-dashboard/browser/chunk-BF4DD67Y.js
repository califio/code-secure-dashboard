import{a as $}from"./chunk-GFWY2OHI.js";import{a as _e,b as M,c as ge}from"./chunk-23W66GLT.js";import{a as W}from"./chunk-LQL43AHG.js";import{a as A}from"./chunk-ZXCPSW3B.js";import{a as he}from"./chunk-JFWL3IR4.js";import"./chunk-7JDTD5PV.js";import{da as I}from"./chunk-G46RF4U2.js";import{a as k}from"./chunk-QXA7VEUO.js";import{o as h,p as T}from"./chunk-ZSGDYSVW.js";import{a as fe}from"./chunk-CEX33KBR.js";import{b as ce,c as F}from"./chunk-ZEESFLET.js";import"./chunk-7ICDGKY7.js";import{a as E}from"./chunk-ENGL65RD.js";import"./chunk-32FVIJUL.js";import{d as ne,f as se}from"./chunk-2IXFTJ2H.js";import{a as ae,b as pe}from"./chunk-UHSV32VQ.js";import{b as x,c as j,d as y,i as L,l as de,q as P,r as z}from"./chunk-5ASYMZAG.js";import{a as me,b as ue}from"./chunk-PHZ4YKFG.js";import"./chunk-T2ZIFUV5.js";import"./chunk-KENT5INO.js";import{e as le}from"./chunk-FHVUNOKG.js";import"./chunk-3OH2LOAZ.js";import{H as g,Ib as a,Jb as b,Kb as ie,Mb as R,Nb as V,Ob as q,P as K,Q as X,Qb as U,Sa as l,Ta as u,Ub as re,V as Y,Vb as oe,Za as f,ba as C,db as w,f as J,fb as p,hb as O,kb as S,la as B,lb as Z,ma as N,nb as ee,ob as te,pb as r,qb as i,rb as c,tb as Q,wb as d,xb as v}from"./chunk-LUMD5QXA.js";import"./chunk-AIZVJUQQ.js";var D=(()=>{class n{loading=!1;filter={desc:!0,name:"",page:1,roleId:null,sortBy:h.CreatedAt,status:void 0};users=f([]);currentPage=f(1);totalPage=f(1);count=f(0);showAddUserPopup=f(!1);showUpdateUserPopup=f(!1);showDisableUserPopup=f(!1);showSendEmailConfirmPopup=f(!1);roleOptions=f([]);constructor(){}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Y({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Se=(()=>{class n{userStore;userService;roleService;toastr;loading=!1;roleOptions=[];request={role:"",email:""};constructor(t,o,e,s){this.userStore=t,this.userService=o,this.roleService=e,this.toastr=s}ngOnInit(){this.roleService.getRoles().subscribe(t=>{this.roleOptions=this.roleOptions=t.map(o=>({value:o.name,label:o.name})),t.length>0&&(this.request.role=t[0].name)})}onCancel(){this.userStore.showAddUserPopup.set(!1),this.resetBody()}onAddUser(){this.loading=!0,this.userService.createUserByAdmin({body:this.request}).pipe(g(()=>this.loading=!1)).subscribe(t=>{let o=this.userStore.users();o.push(t),this.userStore.users.set(o),this.toastr.success("Add user success!"),this.userStore.showAddUserPopup.set(!1),this.resetBody()})}onRoleChange(t){this.request.role=t}resetBody(){this.request={role:"",email:""}}static \u0275fac=function(o){return new(o||n)(u(D),u(A),u(W),u(I))};static \u0275cmp=C({type:n,selectors:[["app-add-user-popup"]],standalone:!0,features:[U],decls:18,vars:7,consts:[[1,"fixed","top-0","right-0","left-0","z-50","h-screen","w-screen","bg-gray-100/80","dark:bg-gray-700/80"],[1,"flex","flex-col","w-full","h-full","items-center","justify-center","text-xs"],[1,"flex","flex-row","justify-center","w-full","h-fit"],[1,"flex","flex-col","gap-3","w-fit","h-fit","min-w-[400px]","border","border-border","bg-background","shadow-lg","p-4","rounded-lg"],[1,"flex","flex-col","gap-1","w-full"],[1,"font-semibold"],["type","text",1,"py-2","w-full",3,"ngModelChange","ngModel"],[3,"selectedChange","options","selected","showLabel"],[1,"flex","flex-row","items-center","gap-4","justify-end"],[1,"flex","flex-row","items-center","gap-4","w-fit"],["app-button","","type","primary",3,"click","loading"],["app-button","","type","default",3,"click"]],template:function(o,e){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),a(6,"Email"),i(),r(7,"input",6),q("ngModelChange",function(m){return V(e.request.email,m)||(e.request.email=m),m}),i()(),r(8,"div",4)(9,"div",5),a(10,"Role"),i(),r(11,"dropdown",7),d("selectedChange",function(m){return e.onRoleChange(m)}),i()(),r(12,"div",8)(13,"div",9)(14,"button",10),d("click",function(){return e.onAddUser()}),a(15," Invite "),i(),r(16,"button",11),d("click",function(){return e.onCancel()}),a(17," Cancel "),i()()()()()()()),o&2&&(O("hidden",!e.userStore.showAddUserPopup()),l(7),R("ngModel",e.request.email),l(4),p("options",e.roleOptions)("selected",e.request.role)("showLabel",!1),l(3),p("loading",e.loading))},dependencies:[E,k,P,x,y,L]})}return n})();var be=(()=>{class n{store;userService;toastr;formService;_user;set user(t){t&&(this._user=t,this.form.patchValue(t))}formConfig=new _e({status:new M(T.Active,j.required),email:new M("",j.required),role:new M("",j.required),fullName:new M("",j.required)});form;statusOptions=[{value:T.Active,label:"Active"},{value:T.Disabled,label:"Disabled"}];constructor(t,o,e,s){this.store=t,this.userService=o,this.toastr=e,this.formService=s,this.form=this.formService.group(this.formConfig)}changeRoleUser(t){this.form.controls.role.setValue(t)}onUpdateUser(){this.form.disable(),this.userService.updateUserByAdmin({userId:this._user.id,body:this.form.value}).pipe(g(()=>this.form.enable())).subscribe(t=>{let o=this.store.users().map(e=>e.id!=t.id?e:t);this.store.users.set(o),this.toastr.success("Update user success!"),this.store.showUpdateUserPopup.set(!1)})}onCancel(){this.store.showUpdateUserPopup.set(!1)}changeStatusUser(t){this.form.controls.status.setValue(t)}static \u0275fac=function(o){return new(o||n)(u(D),u(A),u(I),u(ge))};static \u0275cmp=C({type:n,selectors:[["app-update-user-popup"]],inputs:{user:"user"},standalone:!0,features:[U],decls:26,vars:14,consts:[[1,"fixed","top-0","right-0","left-0","z-50","h-screen","w-screen","text-sm","bg-gray-100/80","dark:bg-gray-700/80"],[1,"flex","flex-col","w-full","h-full","items-center","justify-center"],[1,"flex","flex-row","justify-center","w-full","h-fit"],[1,"flex","flex-col","gap-3","w-fit","h-fit","min-w-[480px]","border","border-border","bg-background","shadow-lg","p-4","rounded-lg"],[1,"flex","flex-col","gap-1","w-full"],[1,"font-semibold"],[3,"username","avatar","fullName","email"],["type","text","name","email",3,"formControl"],[3,"selectedChange","options","showLabel","selected"],[1,"text-sm",3,"selectedChange","options","selected","showLabel"],[1,"flex","flex-row","items-center","gap-4","justify-end"],[1,"flex","flex-row","items-center","gap-4","w-fit"],["app-button","","type","primary",3,"click","loading"],["app-button","","type","default",3,"click"]],template:function(o,e){if(o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),a(6,"User"),i(),c(7,"user-info",6),i(),r(8,"div",4)(9,"div",5),a(10,"Email"),i(),c(11,"input",7),i(),r(12,"div",4)(13,"div",5),a(14,"Role"),i(),r(15,"dropdown",8),d("selectedChange",function(m){return e.changeRoleUser(m)}),i()(),r(16,"div",4)(17,"div",5),a(18,"Status"),i(),r(19,"dropdown",9),d("selectedChange",function(m){return e.changeStatusUser(m)}),i()(),r(20,"div",10)(21,"div",11)(22,"button",12),d("click",function(){return e.onUpdateUser()}),a(23," Update "),i(),r(24,"button",13),d("click",function(){return e.onCancel()}),a(25," Cancel "),i()()()()()()()),o&2){let s;O("hidden",!e.store.showUpdateUserPopup()),l(7),p("username",(s=e._user==null?null:e._user.userName)!==null&&s!==void 0?s:"Unknown")("avatar",e._user==null?null:e._user.avatar)("fullName",e.form.controls.fullName==null?null:e.form.controls.fullName.value)("email",e.form.controls.email==null?null:e.form.controls.email.value),l(4),p("formControl",e.form.controls.email),l(4),p("options",e.store.roleOptions())("showLabel",!1)("selected",e.form.controls.role==null?null:e.form.controls.role.value),l(4),p("options",e.statusOptions)("selected",e.form.controls.status==null?null:e.form.controls.status.value)("showLabel",!1),l(3),p("loading",e.form.disabled)}},dependencies:[$,k,E,P,x,y,z,de]})}return n})();function ye(n,_){n&1&&c(0,"ng-icon",38)}function Pe(n,_){n&1&&c(0,"ng-icon",39)}function Ee(n,_){if(n&1&&(c(0,"ng-icon",46),r(1,"span"),a(2),i()),n&2){let t=v().$implicit;l(2),b(t.lockout)}}function ke(n,_){if(n&1){let t=Q();r(0,"ng-icon",47),d("click",function(){B(t);let e=v().$implicit,s=v(2);return N(s.showSendEmailConfirmPopup(e))}),i()}n&2&&p("tooltip","send email confirm")}function Ae(n,_){if(n&1){let t=Q();r(0,"tr")(1,"td",33),c(2,"input",34),i(),r(3,"td"),c(4,"user-info",35),i(),r(5,"td")(6,"span",36),a(7),i()(),r(8,"td")(9,"div",27)(10,"span"),a(11),i()()(),r(12,"td",37)(13,"div",27),w(14,ye,1,0,"ng-icon",38)(15,Pe,1,0,"ng-icon",39),i()(),r(16,"td",37)(17,"div",40),w(18,Ee,3,1),i()(),r(19,"td")(20,"span",41),a(21),re(22,"timeago"),i()(),r(23,"td")(24,"div",42),w(25,ke,1,1,"ng-icon",43),r(26,"ng-icon",44),d("click",function(){let e=B(t).$implicit,s=v(2);return N(s.showUpdateUserPopup(e))}),i(),r(27,"ng-icon",45),d("click",function(){let e=B(t).$implicit,s=v(2);return N(s.showConfirmDisableUserPopup(e))}),i()()()()}if(n&2){let t,o=_.$implicit;l(4),p("avatar",o.avatar)("username",(t=o.userName)!==null&&t!==void 0?t:"Unknown")("fullName",o.fullName)("email",o.email),l(3),b(o.role),l(4),b(o.status),l(3),S(o.verified?14:15),l(4),S(o.lockout?18:-1),l(2),p("tooltip",o.createdAt),l(),b(oe(22,12,o.createdAt)),l(4),S(o.verified?-1:25),l(2),p("tooltip","disable user")}}function Te(n,_){if(n&1&&(r(0,"tbody"),ee(1,Ae,28,14,"tr",null,Z),i()),n&2){let t=v();l(),te(t.store.users())}}function Ie(n,_){n&1&&c(0,"loading-table")}var _t=(()=>{class n{userService;store;router;route;roleService;toastr;loading=!1;sortOptions=[h.Status,h.CreatedAt,h.UpdatedAt];sorts=[{value:h.CreatedAt,label:"Created"},{value:h.UpdatedAt,label:"Updated"},{value:h.Status,label:"Status"}];user=void 0;constructor(t,o,e,s,m,Ue){this.userService=t,this.store=o,this.router=e,this.route=s,this.roleService=m,this.toastr=Ue}ngOnInit(){this.route.queryParams.pipe(K(t=>(this.loading=!0,ce(t,this.store.filter),this.userService.getUsersByAdmin({body:this.store.filter}).pipe(g(()=>{this.loading=!1})))),X(this.destroy$)).subscribe(t=>{this.store.users.set(t.items),this.store.currentPage.set(t.currentPage),this.store.totalPage.set(t.pageCount),this.store.count.set(t.count)}),this.roleService.getRoles().subscribe(t=>{let o=t.map(e=>({value:e.name,label:e.name}));this.store.roleOptions.set(o)})}onSearchChange(){F(this.router,this.store.filter)}onOrderChange(){this.store.filter.desc=!this.store.filter.desc,F(this.router,this.store.filter)}onSortChange(t){this.store.filter.sortBy=t,F(this.router,this.store.filter)}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onChangePage(t){this.store.filter.page=t,F(this.router,this.store.filter)}destroy$=new J;addUser(){this.store.showAddUserPopup.set(!0)}showConfirmDisableUserPopup(t){this.user=t,this.store.showDisableUserPopup.set(!0)}showUpdateUserPopup(t){this.user=t,this.store.showUpdateUserPopup.set(!0)}disableUser(){this.user&&this.userService.updateUserByAdmin({userId:this.user.id,body:{status:T.Disabled}}).subscribe(t=>{let o=this.store.users().map(e=>e.id==t.id?t:e);this.store.users.set(o),this.store.showDisableUserPopup.set(!1),this.toastr.success("Disabled user success!")})}showSendEmailConfirmPopup(t){this.user=t,this.store.showSendEmailConfirmPopup.set(!0)}sendEmailConfirmUser(){this.user&&this.userService.sendConfirmEmail({userId:this.user.id}).pipe(g(()=>this.store.showSendEmailConfirmPopup.set(!1))).subscribe(()=>{this.toastr.success("Send confirm email success!")})}static \u0275fac=function(o){return new(o||n)(u(A),u(D),u(se),u(ne),u(W),u(I))};static \u0275cmp=C({type:n,selectors:[["app-user"]],standalone:!0,features:[U],decls:60,vars:15,consts:[[1,"mx-auto","px-2","lg:px-6","flex","flex-col","pt-6","text-sm"],[1,"font-semibold","text-foreground","mb-2","ml-1","text-xl"],[1,"flex","min-w-full","flex-col","rounded-xl","border","border-border","bg-background"],[1,"flex","flex-col","py-3","px-5"],[1,"flex","flex-wrap","md:flex-row","items-center","justify-between","gap-2"],[1,"flex","flex-row","gap-2"],[1,"flex","w-full","md:max-w-80"],[1,"relative","text-muted-foreground","w-full"],[1,"absolute","left-2.5","top-2.5"],["name","heroMagnifyingGlass"],["placeholder","Search...","type","text",1,"py-2","pl-8","pr-2","w-full",3,"ngModelChange","keyup.enter","ngModel"],[1,"flex","flex-row","space-x-2","items-center"],[3,"selectedChange","options","selected"],["dropdown-label","",1,"font-semibold"],["size","16",1,"cursor-pointer",3,"click","name"],[1,"flex","flex-row","items-center","gap-2"],["app-button","","type","primary",3,"click"],[1,"mt-3","px-1","py-1","whitespace-nowrap"],[1,"font-bold"],[1,"overflow-x-auto"],[1,"table","w-full","table-auto","border-collapse","border-0","text-left","align-middle","leading-5","text-muted-foreground"],[1,"border-t","border-border","text-xs","text-muted-foreground"],[1,"w-[50px]","min-w-[50px]","text-center"],["data-datatable-check","true","type","checkbox",1,"checkbox","checkbox-sm"],[1,"min-w-[300px]","uppercase"],[1,"min-w-[180px]","uppercase"],[1,"min-w-[80px]","uppercase"],[1,"w-full","flex","flex-row","items-center","justify-center"],[1,"min-w-[60px]","uppercase"],[1,"w-[100px]","uppercase"],[1,"sticky","bottom-0","z-10",3,"pageChange","currentPage","totalPage"],[3,"cancel","confirm","hidden","title"],[3,"user"],[1,"text-center"],["data-datatable-row-check","true","type","checkbox","value","28",1,"checkbox","checkbox-sm"],[3,"avatar","username","fullName","email"],[1,"w-full"],[1,"text-xl"],["name","heroCheckCircle",1,"text-green-500"],["name","xCircle",1,"text-red-500"],[1,"w-full","flex","flex-row","items-center","justify-center","gap-2"],[3,"tooltip"],[1,"w-full","flex","flex-row","items-center","justify-center","text-lg","gap-2"],["name","heroPaperAirplane",1,"cursor-pointer",3,"tooltip"],["name","pencilSquare",1,"cursor-pointer",3,"click"],["name","xCircle",1,"cursor-pointer",3,"click","tooltip"],["name","heroCheck",1,"text-red-500"],["name","heroPaperAirplane",1,"cursor-pointer",3,"click","tooltip"]],template:function(o,e){o&1&&(r(0,"div",0)(1,"div",1),a(2,"User Manager"),i(),r(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7)(9,"div",8),c(10,"ng-icon",9),i(),r(11,"input",10),q("ngModelChange",function(m){return V(e.store.filter.name,m)||(e.store.filter.name=m),m}),d("keyup.enter",function(){return e.onSearchChange()}),i()()(),r(12,"div",11)(13,"dropdown",12),d("selectedChange",function(m){return e.onSortChange(m)}),r(14,"span",13),a(15,"Sort By"),i()(),r(16,"ng-icon",14),d("click",function(){return e.onOrderChange()}),i()()(),r(17,"div",15)(18,"button",16),d("click",function(){return e.addUser()}),a(19,"Add User"),i()()(),r(20,"div",17),a(21),r(22,"span",18),a(23),i(),a(24," results"),i()(),r(25,"div",19)(26,"table",20)(27,"thead",21)(28,"tr")(29,"th",22),c(30,"input",23),i(),r(31,"th",24),a(32,"User"),i(),r(33,"th",25),a(34,"Role"),i(),r(35,"th",26)(36,"div",27)(37,"span"),a(38,"Status"),i()()(),r(39,"th",28)(40,"div",27)(41,"span"),a(42,"Verified"),i()()(),r(43,"th",26)(44,"div",27)(45,"span"),a(46,"Lockout"),i()()(),r(47,"th",25),a(48,"CREATED AT"),i(),r(49,"th",29)(50,"div",27)(51,"span"),a(52,"ACTION"),i()()()()(),w(53,Te,3,0,"tbody"),i()(),w(54,Ie,1,0,"loading-table"),r(55,"pagination",30),d("pageChange",function(m){return e.onChangePage(m)}),i()()(),r(56,"confirm-popup",31),d("cancel",function(){return e.store.showDisableUserPopup.set(!1)})("confirm",function(){return e.disableUser()}),i(),r(57,"confirm-popup",31),d("cancel",function(){return e.store.showSendEmailConfirmPopup.set(!1)})("confirm",function(){return e.sendEmailConfirmUser()}),i(),c(58,"app-add-user-popup")(59,"app-update-user-popup",32)),o&2&&(l(11),R("ngModel",e.store.filter.name),l(2),p("options",e.sorts)("selected",e.store.filter.sortBy),l(3),p("name",e.store.filter.desc?"desc":"asc"),l(5),ie("Displaying ",e.store.users().length," in "),l(2),b(e.store.count()),l(30),S(e.loading?-1:53),l(),S(e.loading?54:-1),l(),p("currentPage",e.store.currentPage())("totalPage",e.store.totalPage()),l(),p("hidden",!e.store.showDisableUserPopup())("title","Are you sure you want to disable this user?"),l(),p("hidden",!e.store.showSendEmailConfirmPopup())("title","Are you sure you want to send a confirming email to active this account?"),l(2),p("user",e.user))},dependencies:[ae,le,pe,z,x,y,ue,me,P,L,$,k,E,Se,be,he,fe]})}return n})();export{_t as UserComponent};
