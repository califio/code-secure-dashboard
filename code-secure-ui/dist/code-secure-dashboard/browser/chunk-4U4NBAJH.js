import{a as K}from"./chunk-GFWY2OHI.js";import{a as Ce}from"./chunk-ZXCPSW3B.js";import"./chunk-PJ57YFKH.js";import{a as we}from"./chunk-JFWL3IR4.js";import{a as ue}from"./chunk-7JDTD5PV.js";import{da as P}from"./chunk-G46RF4U2.js";import{a as j}from"./chunk-YHE4N465.js";import{a as J}from"./chunk-QXA7VEUO.js";import{h as v}from"./chunk-ZSGDYSVW.js";import{a as _e}from"./chunk-CEX33KBR.js";import{b as ve,c as Y}from"./chunk-ZEESFLET.js";import"./chunk-7ICDGKY7.js";import{a as y}from"./chunk-ENGL65RD.js";import{a as M}from"./chunk-W4N5Z7QK.js";import"./chunk-32FVIJUL.js";import{d as de,f as ce}from"./chunk-2IXFTJ2H.js";import{a as fe,b as he}from"./chunk-UHSV32VQ.js";import{b as q,d as G,i as Q,q as H}from"./chunk-5ASYMZAG.js";import{a as be,b as ge}from"./chunk-PHZ4YKFG.js";import"./chunk-T2ZIFUV5.js";import"./chunk-KENT5INO.js";import{e as $}from"./chunk-FHVUNOKG.js";import{i as me}from"./chunk-3OH2LOAZ.js";import{H as h,Ib as s,Jb as E,Kb as X,Mb as B,Nb as L,Ob as W,P as te,Q as oe,Qb as C,R as re,Sa as a,Ta as p,Ub as ae,V as F,Va as le,Vb as se,Za as b,_ as R,ac as pe,ba as _,db as w,f as A,fb as c,hb as S,kb as x,la as U,lb as N,ma as D,nb as V,ob as O,pb as n,qb as i,ra as ie,rb as u,ta as ne,tb as z,wb as m,xb as g}from"./chunk-LUMD5QXA.js";import"./chunk-AIZVJUQQ.js";var k=(()=>{class r{filter={desc:!0,name:"",page:1,role:void 0,size:20};loading=b(!1);members=b([]);currentPage=b(1);totalPage=b(1);count=b(0);showUpdateMemberPopup=b(!1);showAddMemberPopup=b(!1);showConfirmDeleteMemberPopup=b(!1);constructor(){}static \u0275fac=function(o){return new(o||r)};static \u0275prov=F({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Me=(()=>{class r{projectStore;projectService;memberStore;toastr;user={};roles=[{label:"Developer",value:v.Developer},{label:"Validator",value:v.Validator},{label:"Manager",value:v.Manager}];loading=!1;constructor(t,o,e,l){this.projectStore=t,this.projectService=o,this.memberStore=e,this.toastr=l}changeRoleUser(t){this.user.role=t}onUpdateRole(){this.loading=!0,this.projectService.updateProjectMember({projectId:this.projectStore.projectId(),userId:this.user.userId??"",body:{role:this.user.role}}).pipe(h(()=>this.loading=!1)).subscribe(t=>{let o=this.memberStore.members().map(e=>e.userId!=t.userId?e:t);this.memberStore.members.set(o),this.toastr.success("Update member success!"),this.memberStore.showUpdateMemberPopup.set(!1)})}onCancel(){this.memberStore.showUpdateMemberPopup.set(!1)}static \u0275fac=function(o){return new(o||r)(p(j),p(M),p(k),p(P))};static \u0275cmp=_({type:r,selectors:[["app-update-member-popup"]],inputs:{user:"user"},standalone:!0,features:[C],decls:18,vars:10,consts:[[1,"fixed","top-0","right-0","left-0","z-50","h-screen","w-screen"],[1,"flex","flex-col","w-full","h-full","items-center","justify-center"],[1,"flex","flex-row","justify-center","w-full","h-fit"],[1,"flex","flex-col","gap-3","w-fit","h-fit","min-w-[480px]","border","border-border","bg-background","shadow-lg","p-4","rounded-lg"],[1,"flex","flex-col","gap-1","w-full"],[1,"font-semibold"],[3,"username","avatar","fullName","email"],[1,"w-fit","text-sm",3,"selectedChange","options","selected","showLabel"],[1,"flex","flex-row","items-center","gap-4","justify-end"],[1,"flex","flex-row","items-center","gap-4","w-fit"],["app-button","","type","primary",3,"click","loading"],["app-button","","type","default",3,"click"]],template:function(o,e){if(o&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),s(6,"User"),i(),u(7,"user-info",6),i(),n(8,"div",4)(9,"div",5),s(10,"Role"),i(),n(11,"dropdown",7),m("selectedChange",function(d){return e.changeRoleUser(d)}),i()(),n(12,"div",8)(13,"div",9)(14,"button",10),m("click",function(){return e.onUpdateRole()}),s(15," Update "),i(),n(16,"button",11),m("click",function(){return e.onCancel()}),s(17," Cancel "),i()()()()()()()),o&2){let l;S("hidden",!e.memberStore.showUpdateMemberPopup()),a(7),c("username",(l=e.user.userName)!==null&&l!==void 0?l:"Unknown")("avatar",e.user.avatar)("fullName",e.user.fullName)("email",e.user.email),a(4),c("options",e.roles)("selected",e.user.role)("showLabel",!1),a(3),c("loading",e.loading)}},dependencies:[J,y,K]})}return r})();function De(r,f){if(r&1&&u(0,"user-info",2),r&2){let t,o=g();c("username",(t=o.selectedOption.userName)!==null&&t!==void 0?t:"Unknown")("fullName",o.selectedOption.fullName)("email",o.selectedOption.email)("avatar",o.selectedOption.avatar)}}function Ee(r,f){r&1&&(n(0,"span"),s(1,"Select User"),i())}function Te(r,f){r&1&&u(0,"ng-icon",8)}function Ae(r,f){r&1&&u(0,"ng-icon",9)}function Fe(r,f){if(r&1){let t=z();n(0,"li",14),m("click",function(){let e=U(t).$implicit,l=g(2);return D(l.onClick(e))}),u(1,"user-info",15),i()}if(r&2){let t,o=f.$implicit,e=g(2);c("ngClass",o.id==(e.selectedOption==null?null:e.selectedOption.id)?"bg-gray-100 dark:bg-card":""),a(),c("username",(t=o.userName)!==null&&t!==void 0?t:"Unknown")("avatar",o.avatar)}}function Re(r,f){if(r&1&&(n(0,"ul",11),V(1,Fe,2,3,"li",13,N),i()),r&2){let t=g();a(),O(t.options)}}function Ne(r,f){r&1&&(n(0,"div",12)(1,"span",16),s(2,"No results found"),i()())}var je=(()=>{class r{userService;name="";hidden=!0;options=[];selectedOption=void 0;loading=!1;constructor(t){this.userService=t,this.loading=!0,this.userService.getUsers({body:{}}).pipe(h(()=>this.loading=!1)).subscribe(o=>{this.options=o.items})}set selected(t){this.selectedOption=this.options.find(o=>o.id==t)}selectChange=new ne;onClick(t){this.selectedOption=t,this.selectChange.emit(t),this.hidden=!0}onSearch(){this.loading=!0,this.userService.getUsers({body:{name:this.name}}).pipe(h(()=>this.loading=!1)).subscribe(t=>{this.options=t.items})}static \u0275fac=function(o){return new(o||r)(p(Ce))};static \u0275cmp=_({type:r,selectors:[["user-dropdown"]],inputs:{selected:"selected"},outputs:{selectChange:"selectChange"},standalone:!0,features:[C],decls:14,vars:6,consts:[[1,"flex","flex-col","items-start"],[1,"flex","flex-row","gap-1","items-center","rounded-md","px-3","py-2","font-semibold","w-fit",3,"click"],[3,"username","fullName","email","avatar"],["name","heroChevronDown"],[1,"z-10","absolute","mt-14","rounded","shadow","w-fit","border","border-border","bg-background","overflow-y-auto","max-h-96"],[1,"flex","w-full","rounded-t","p-2"],[1,"relative","text-muted-foreground","w-full"],[1,"absolute","left-2.5","top-2"],["name","spin",1,"animate-spin"],["name","heroMagnifyingGlass"],["placeholder","Search...","type","text",1,"py-2","pl-8","pr-2","rounded-none","w-full","border",3,"ngModelChange","keyup.enter","ngModel"],[1,"py-2"],[1,"flex","flex-row","justify-center","w-full","py-4"],[1,"cursor-pointer","mx-2","px-2","py-1","rounded","bg-background","placeholder-muted-foreground","hover:bg-gray-100","dark:hover:bg-card",3,"ngClass"],[1,"cursor-pointer","mx-2","px-2","py-1","rounded","bg-background","placeholder-muted-foreground","hover:bg-gray-100","dark:hover:bg-card",3,"click","ngClass"],[3,"username","avatar"],[1,"text-xs"]],template:function(o,e){o&1&&(n(0,"div",0)(1,"button",1),m("click",function(){return e.hidden=!e.hidden}),w(2,De,1,4,"user-info",2)(3,Ee,2,0,"span"),u(4,"ng-icon",3),i(),n(5,"div",4)(6,"div",5)(7,"label",6)(8,"div",7),w(9,Te,1,0,"ng-icon",8)(10,Ae,1,0,"ng-icon",9),i(),n(11,"input",10),W("ngModelChange",function(d){return L(e.name,d)||(e.name=d),d}),m("keyup.enter",function(){return e.onSearch()}),i()()(),w(12,Re,3,0,"ul",11)(13,Ne,3,0,"div",12),i()()),o&2&&(a(2),x(e.selectedOption?2:3),a(3),S("hidden",e.hidden),a(4),x(e.loading?9:10),a(2),B("ngModel",e.name),a(),x(e.options.length>0?12:13))},dependencies:[$,K,me,H,q,G,Q]})}return r})();var Pe=(()=>{class r{memberStore;projectStore;projectService;toastr;user=void 0;loading=!1;role=v.Developer;roles=[{label:"Developer",value:v.Developer},{label:"Validator",value:v.Validator},{label:"Manager",value:v.Manager}];constructor(t,o,e,l){this.memberStore=t,this.projectStore=o,this.projectService=e,this.toastr=l}onSelectUser(t){this.user=t}onSelectRole(t){this.role=t}onCancel(){this.memberStore.showAddMemberPopup.set(!1)}onAddUser(){this.loading=!0,this.projectService.addMember({projectId:this.projectStore.projectId(),body:{userId:this.user?.id,role:this.role}}).pipe(h(()=>this.loading=!1)).subscribe(t=>{let o=this.memberStore.members();o.push(t),this.memberStore.members.set(o),this.toastr.success("Add member success!"),this.memberStore.showAddMemberPopup.set(!1),this.user=void 0})}static \u0275fac=function(o){return new(o||r)(p(k),p(j),p(M),p(P))};static \u0275cmp=_({type:r,selectors:[["app-add-member-popup"]],inputs:{user:"user"},standalone:!0,features:[C],decls:18,vars:6,consts:[[1,"fixed","top-0","right-0","left-0","z-50","h-screen","w-screen"],[1,"flex","flex-col","w-full","h-full","items-center","justify-center"],[1,"flex","flex-row","justify-center","w-full","h-fit"],[1,"flex","flex-col","gap-3","w-fit","h-fit","min-w-[480px]","border","border-border","bg-background","shadow-lg","p-4","rounded-lg"],[1,"flex","flex-col","gap-1","w-full"],[1,"font-semibold"],[1,"w-fit",3,"selectChange"],[3,"selectedChange","options","selected","showLabel"],[1,"flex","flex-row","items-center","gap-4","justify-end"],[1,"flex","flex-row","items-center","gap-4","w-fit"],["app-button","","type","primary",3,"click","loading"],["app-button","","type","default",3,"click"]],template:function(o,e){o&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),s(6,"User"),i(),n(7,"user-dropdown",6),m("selectChange",function(d){return e.onSelectUser(d)}),i()(),n(8,"div",4)(9,"div",5),s(10,"Role"),i(),n(11,"dropdown",7),m("selectedChange",function(d){return e.onSelectRole(d)}),i()(),n(12,"div",8)(13,"div",9)(14,"button",10),m("click",function(){return e.onAddUser()}),s(15," Add "),i(),n(16,"button",11),m("click",function(){return e.onCancel()}),s(17," Cancel "),i()()()()()()()),o&2&&(S("hidden",!e.memberStore.showAddMemberPopup()),a(11),c("options",e.roles)("selected",e.role)("showLabel",!1),a(3),c("loading",e.loading))},dependencies:[y,J,je]})}return r})();var ke=(()=>{class r{componentFactoryResolver;appRef;injector;constructor(t,o,e){this.componentFactoryResolver=t,this.appRef=o,this.injector=e}open(t,o){let l=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector);this.appRef.attachView(l.hostView);let d=l.hostView.rootNodes[0];document.body.appendChild(d);let I=new A;return{close:Ie=>{this.appRef.detachView(l.hostView),l.destroy(),I.next(Ie),I.complete()},afterClosed:I}}static \u0275fac=function(o){return new(o||r)(R(le),R(pe),R(ie))};static \u0275prov=F({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Oe(r,f){if(r&1){let t=z();n(0,"tr")(1,"td",26),u(2,"input",27),i(),n(3,"td")(4,"div",28)(5,"div",29),u(6,"avatar",30),i(),n(7,"div",31),s(8),n(9,"p",32),s(10),i()()()(),n(11,"td")(12,"span",33),s(13),i()(),n(14,"td")(15,"span",34),s(16),ae(17,"timeago"),i()(),n(18,"td")(19,"div",35)(20,"ng-icon",36),m("click",function(){let e=U(t).$implicit,l=g(2);return D(l.showUpdateMemberPopup(e))}),i(),n(21,"ng-icon",37),m("click",function(){let e=U(t).$implicit,l=g(2);return D(l.showConfirmDeleteMemberPopup(e))}),i()()()()}if(r&2){let t,o,e=f.$implicit;a(6),c("src",(t=e.avatar)!==null&&t!==void 0?t:void 0)("shape","square")("ngClass","rounded-lg")("size",36)("text",(o=e.userName)!==null&&o!==void 0?o:"Unknown"),a(2),X(" ",e.fullName||e.userName," "),a(2),E(e.email),a(3),E(e.role),a(2),c("tooltip",e.createdAt),a(),E(se(17,10,e.createdAt))}}function ze(r,f){if(r&1&&(n(0,"tbody"),V(1,Oe,22,12,"tr",null,N),i()),r&2){let t=g();a(),O(t.store.members())}}function Be(r,f){r&1&&u(0,"loading-table")}var Nt=(()=>{class r{store;projectStore;projectService;toastr;router;route;modalService;destroy$=new A;constructor(t,o,e,l,d,I,ee){this.store=t,this.projectStore=o,this.projectService=e,this.toastr=l,this.router=d,this.route=I,this.modalService=ee}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnInit(){this.route.queryParams.pipe(te(t=>(ve(t,this.store.filter),this.getProjectUsers())),oe(this.destroy$)).subscribe()}onSearchChange(){Y(this.router,this.store.filter)}onChangePage(t){this.store.filter.page=t,Y(this.router,this.store.filter)}getProjectUsers(){return this.store.loading.set(!0),this.projectService.getProjectUsers({projectId:this.projectStore.projectId(),body:this.store.filter}).pipe(h(()=>this.store.loading.set(!1)),re(t=>{this.store.members.set(t.items),this.store.currentPage.set(t.currentPage),this.store.totalPage.set(t.pageCount),this.store.count.set(t.count)}))}deleteMember(){this.projectService.deleteProjectMember({projectId:this.projectStore.projectId(),userId:this.member.userId??""}).subscribe(()=>{let t=this.store.members().filter(o=>o.userId!=this.member?.userId);this.store.members.set(t),this.toastr.success("Delete member success!"),this.store.showConfirmDeleteMemberPopup.set(!1)})}showConfirmDeleteMemberPopup(t){this.member=t,this.store.showConfirmDeleteMemberPopup.set(!0)}showUpdateMemberPopup(t){this.member=t,this.store.showUpdateMemberPopup.set(!0)}member={};showAddMemberPopup(){this.store.showAddMemberPopup.set(!0)}static \u0275fac=function(o){return new(o||r)(p(k),p(j),p(M),p(P),p(ce),p(de),p(ke))};static \u0275cmp=_({type:r,selectors:[["app-member"]],standalone:!0,features:[C],decls:40,vars:9,consts:[[1,"mx-auto","flex","flex-col","text-sm"],[1,"font-semibold","text-foreground","mb-2","ml-1","text-xl"],[1,"flex","min-w-full","flex-col","border","border-border","bg-background"],[1,"flex","flex-col","py-3","px-5"],[1,"flex","flex-row","gap-2","w-full"],[1,"flex","w-full","md:max-w-80"],[1,"relative","text-muted-foreground","w-full"],[1,"absolute","left-2.5","top-2.5"],["name","heroMagnifyingGlass"],["placeholder","Search...","type","text",1,"py-2","pl-8","pr-2","w-full",3,"ngModelChange","keyup.enter","ngModel"],["app-button","","type","primary",3,"click"],[1,"mt-3","px-1","py-1","whitespace-nowrap"],[1,"font-bold"],[1,"overflow-x-auto"],[1,"table","w-full","table-auto","border-collapse","border-0","text-left","align-middle","leading-5","text-muted-foreground"],[1,"border-t","border-border","text-xs","text-muted-foreground"],[1,"w-[50px]","min-w-[50px]","text-center"],["data-datatable-check","true","type","checkbox",1,"checkbox","checkbox-sm"],[1,"min-w-[300px]","uppercase"],[1,"min-w-[180px]","uppercase"],[1,"w-[80px]"],[1,"w-full","flex","flex-row","items-center","justify-center"],[1,"sticky","bottom-0","z-10",3,"pageChange","currentPage","totalPage"],[3,"cancel","confirm","hidden"],[3,"user"],[1,"w-fit"],[1,"text-center"],["data-datatable-row-check","true","type","checkbox","value","28",1,"checkbox","checkbox-sm"],[1,"flex-row","flex","items-center","px-4"],[1,"w-10","shrink-0"],[3,"src","shape","ngClass","size","text"],[1,"overflow-hidden","px-2","text-sm","font-semibold","text-foreground"],[1,"truncate","text-ellipsis","text-xs","font-semibold","text-muted-foreground"],[1,"w-full"],[3,"tooltip"],[1,"w-full","flex","flex-row","items-center","justify-center","gap-2","text-lg"],["name","pencilSquare",1,"cursor-pointer",3,"click"],["name","trash",1,"cursor-pointer",3,"click"]],template:function(o,e){o&1&&(n(0,"div",0)(1,"div",1),s(2,"Member Manager"),i(),n(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"label",6)(8,"div",7),u(9,"ng-icon",8),i(),n(10,"input",9),W("ngModelChange",function(d){return L(e.store.filter.name,d)||(e.store.filter.name=d),d}),m("keyup.enter",function(){return e.onSearchChange()}),i()()(),n(11,"button",10),m("click",function(){return e.showAddMemberPopup()}),s(12,"Add Member"),i()(),n(13,"div",11),s(14),n(15,"span",12),s(16),i(),s(17," results"),i()(),n(18,"div",13)(19,"table",14)(20,"thead",15)(21,"tr")(22,"th",16),u(23,"input",17),i(),n(24,"th",18),s(25,"User"),i(),n(26,"th",19),s(27,"Role"),i(),n(28,"th",19),s(29,"CREATED AT"),i(),n(30,"th",20)(31,"div",21)(32,"span"),s(33,"ACTION"),i()()()()(),w(34,ze,3,0,"tbody"),i()(),w(35,Be,1,0,"loading-table"),n(36,"pagination",22),m("pageChange",function(d){return e.onChangePage(d)}),i()()(),n(37,"confirm-popup",23),m("cancel",function(){return e.store.showConfirmDeleteMemberPopup.set(!1)})("confirm",function(){return e.deleteMember()}),i(),u(38,"app-update-member-popup",24)(39,"app-add-member-popup",25)),o&2&&(a(10),B("ngModel",e.store.filter.name),a(4),X("Displaying ",e.store.members().length," in "),a(2),E(e.store.count()),a(18),x(e.store.loading()?-1:34),a(),x(e.store.loading()?35:-1),a(),c("currentPage",e.store.currentPage())("totalPage",e.store.totalPage()),a(),c("hidden",!e.store.showConfirmDeleteMemberPopup()),a(),c("user",e.member))},dependencies:[ue,H,q,G,Q,fe,$,he,ge,be,we,Me,y,Pe,_e]})}return r})();export{Nt as MemberComponent};
