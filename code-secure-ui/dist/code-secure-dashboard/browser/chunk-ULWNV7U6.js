import{a as se}from"./chunk-G3Z376R7.js";import{a as re,b as oe,d as ae,e as de}from"./chunk-VI62OPHC.js";import"./chunk-JFWL3IR4.js";import"./chunk-NJ6R6LRK.js";import{a as ie}from"./chunk-RLVYGCTC.js";import"./chunk-2AZPC3K3.js";import"./chunk-7JDTD5PV.js";import{da as le}from"./chunk-G46RF4U2.js";import{a as te}from"./chunk-YHE4N465.js";import{e as ne}from"./chunk-KJV7B77S.js";import{a as Z}from"./chunk-QXA7VEUO.js";import{b as f,f as S}from"./chunk-ZSGDYSVW.js";import"./chunk-CEX33KBR.js";import{b as Y,c as C}from"./chunk-ZEESFLET.js";import"./chunk-7ICDGKY7.js";import"./chunk-ENGL65RD.js";import{a as ee}from"./chunk-W4N5Z7QK.js";import"./chunk-32FVIJUL.js";import{d as W,f as H}from"./chunk-2IXFTJ2H.js";import{b as q}from"./chunk-UHSV32VQ.js";import{b as Q,d as G,i as J,q as K,r as X}from"./chunk-5ASYMZAG.js";import"./chunk-PHZ4YKFG.js";import"./chunk-T2ZIFUV5.js";import"./chunk-KENT5INO.js";import{e as U}from"./chunk-FHVUNOKG.js";import"./chunk-3OH2LOAZ.js";import{H as T,Hb as y,Ib as F,Mb as D,Nb as z,Ob as $,P as E,Q as O,Qa as L,Qb as N,R as B,Sa as g,Ta as h,V as A,Xb as j,Za as w,ba as R,db as v,f as k,fb as p,kb as V,la as d,ma as c,pb as o,qb as l,rb as _,tb as I,v as M,wb as m,xb as b}from"./chunk-LUMD5QXA.js";import{a as P,b as x}from"./chunk-AIZVJUQQ.js";var ce=(()=>{class i{loading=w(!1);currentPage=w(0);totalPage=w(0);commits=w([]);scanners=w([]);findings=w([]);filter={desc:!0,name:"",page:1,scanner:[],severity:void 0,sortBy:S.CreatedAt,status:[],commitId:void 0};constructor(){}static \u0275fac=function(n){return new(n||i)};static \u0275prov=A({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function fe(i,u){if(i&1&&_(0,"scan-branch",26),i&2){let e=u.$implicit;p("action",e.action)("branch",e.branch)("targetBranch",e.targetBranch)}}function ue(i,u){if(i&1&&_(0,"finding-status-label",27),i&2){let e=u.$implicit;p("status",e.value)("defaultLabel",e.label)}}function he(i,u){if(i&1&&_(0,"scanner-label",28),i&2){let e=u.$implicit;p("scanner",e.name)("type",e.type)}}function _e(i,u){if(i&1){let e=I();o(0,"finding-detail",29),m("close",function(){d(e);let t=b();return c(t.closeFinding())}),l()}if(i&2){let e=b();p("isProjectPage",!0)("finding",e.finding)}}function Ce(i,u){i&1&&_(0,"ng-icon",30)}function Se(i,u){i&1&&(_(0,"ng-icon",31),o(1,"div"),F(2,"Select vulnerability to see its details."),l())}function we(i,u){if(i&1&&(o(0,"div",25),v(1,Ce,1,0,"ng-icon",30)(2,Se,3,0),l()),i&2){let e=b();g(),V(e.loadingFinding?1:2)}}var Ge=(()=>{class i{projectService;projectStore;route;router;findingService;store;toastrService;finding=null;showDetailFinding=!1;loadingFinding=!1;selectedFindings=[];commitId=null;statusOptions=[{value:f.Open,label:"Open"},{value:f.Confirmed,label:"Confirmed"},{value:f.Incorrect,label:"False Positive"},{value:f.AcceptedRisk,label:"Accepted Risk"},{value:f.Fixed,label:"Fixed"}];constructor(e,n,t,s,a,r,pe){this.projectService=e,this.projectStore=n,this.route=t,this.router=s,this.findingService=a,this.store=r,this.toastrService=pe}ngOnInit(){this.projectService.getProjectCommits({projectId:this.projectStore.projectId()}).subscribe(e=>{this.store.commits.set(e.map(n=>x(P({},n),{label:n.branch,value:n.commitId}))),this.commitId=this.store.filter.commitId}),this.projectService.getProjectScanners({projectId:this.projectStore.projectId()}).subscribe(e=>{this.store.scanners.set(e.map(n=>x(P({},n),{label:n.name,value:n.id})))}),this.route.queryParams.pipe(E(e=>(Y(e,this.store.filter),this.store.filter.status||(this.store.filter.status=[f.Open,f.Confirmed,f.Fixed,f.AcceptedRisk]),this.getProjectFindings())),O(this.destroy$)).subscribe()}onOpenFinding(e){this.showDetailFinding?this.router.navigate(["/finding",e]).then():(this.finding=null,this.loadingFinding=!0,this.findingService.getFinding({id:e}).pipe(T(()=>{this.loadingFinding=!1})).subscribe(n=>{this.finding=n}))}closeFinding(){this.finding=null}getScreenSize(){this.showDetailFinding=window.innerWidth<1024}destroy$=new k;search="";sortOptions=[{value:S.Name,label:"Name"},{value:S.UpdatedAt,label:"Updated"},{value:S.CreatedAt,label:"Created"},{value:S.Status,label:"Status"},{value:S.Severity,label:"Severity"}];ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onReload(){this.getProjectFindings().subscribe()}getProjectFindings(){return this.store.loading.set(!0),this.store.filter.scanner&&(Array.isArray(this.store.filter.scanner)||(this.store.filter.scanner=[this.store.filter.scanner])),this.projectService.getProjectFindings({projectId:this.projectStore.projectId(),body:this.store.filter}).pipe(T(()=>{this.store.loading.set(!1)}),B(e=>{this.store.findings.set(e.items),this.store.currentPage.set(e.currentPage),this.store.totalPage.set(e.pageCount)}))}onSearchChange(){C(this.router,this.store.filter)}onStatusChange(e){this.store.filter.status=e,C(this.router,this.store.filter)}onSelectScan(e){this.store.filter.commitId=e,C(this.router,this.store.filter)}onPageChange(e){this.store.filter.page=e,C(this.router,this.store.filter)}selectFindingsChange(e){this.selectedFindings=e}onMarkAs(e){if(this.selectedFindings.length>0){let n=this.selectedFindings.map(t=>this.findingService.updateFinding({id:t,body:{status:e}}));M(n).subscribe(t=>{this.toastrService.success(`change status of ${t.length} findings success`),this.selectedFindings=[],this.onReload()})}else this.toastrService.warning("select at least one finding to change status",5e3)}onChangeScanner(e){this.store.filter.scanner=e,C(this.router,this.store.filter)}onOrderChange(){this.store.filter.desc=!this.store.filter.desc,C(this.router,this.store.filter)}onSortChange(e){this.store.filter.sortBy=e,C(this.router,this.store.filter)}static \u0275fac=function(n){return new(n||i)(h(ee),h(te),h(W),h(H),h(ie),h(ce),h(le))};static \u0275cmp=R({type:i,selectors:[["app-finding"]],hostBindings:function(n,t){n&1&&m("resize",function(a){return t.getScreenSize(a)},!1,L)},standalone:!0,features:[N],decls:38,vars:26,consts:[["optionBranchTemplate",""],["optionStatusTemplate",""],["optionScannerTemplate",""],[1,"mx-auto","px-2","lg:px-6","flex","flex-row","pt-6","text-sm","gap-4","w-full"],[1,"flex","flex-col","w-full"],[1,"flex","flex-wrap","w-full","p-4","gap-2","items-center","justify-between","border","border-border","bg-background"],[1,"flex","flex-row","items-center","gap-2"],[1,"flex","w-full","md:max-w-80","text-xs"],[1,"relative","text-muted-foreground","w-full"],[1,"absolute","left-2.5","top-2.5"],["name","heroMagnifyingGlass"],["placeholder","Search...","type","text",1,"py-2","pl-8","pr-2",3,"ngModelChange","keyup.enter","ngModel"],[3,"selectedChange","showSearch","showMaxOption","options","selected","optionTemplate"],["dropdown-label","",1,"font-semibold"],["mode","multiple",3,"selectedChange","showSearch","showMaxOption","options","selected","optionTemplate"],[1,"flex","flex-row","gap-2","items-center"],[3,"selectedChange","options","showSearch","selected"],["size","16",1,"cursor-pointer",3,"click","name"],[1,"flex","items-center","cursor-pointer","px-4","py-2","rounded","bg-background","border","border-border",3,"click"],["name","arrowPath"],[3,"statusChange","fixedLabel"],[1,"w-full","max-h-screen","overflow-y-auto",3,"selectFindings","openFinding","loading","findings"],[1,"sticky","bottom-0",3,"pageChange","currentPage","totalPage"],[1,"hidden","lg:block","w-[800px]","overflow-x-auto"],[3,"isProjectPage","finding"],[1,"flex","flex-col","items-center","justify-center","h-[720px]","w-full"],[3,"action","branch","targetBranch"],[3,"status","defaultLabel"],[3,"scanner","type"],[3,"close","isProjectPage","finding"],["name","spin","size","24",1,"animate-spin"],["name","cursorArrowRays","size","24"]],template:function(n,t){if(n&1){let s=I();o(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"label",8)(6,"div",9),_(7,"ng-icon",10),l(),o(8,"input",11),$("ngModelChange",function(r){return d(s),z(t.store.filter.name,r)||(t.store.filter.name=r),c(r)}),m("keyup.enter",function(){return d(s),c(t.onSearchChange())}),l()()(),o(9,"dropdown",12),m("selectedChange",function(r){return d(s),c(t.onSelectScan(r))}),o(10,"span",13),F(11,"Branch"),l()(),v(12,fe,1,3,"ng-template",null,0,j),o(14,"dropdown",14),m("selectedChange",function(r){return d(s),c(t.onStatusChange(r))}),o(15,"span",13),F(16,"Status"),l()(),v(17,ue,1,2,"ng-template",null,1,j),o(19,"dropdown",14),m("selectedChange",function(r){return d(s),c(t.onChangeScanner(r))}),o(20,"span",13),F(21,"Scanner"),l()(),v(22,he,1,2,"ng-template",null,2,j),o(24,"div",15)(25,"dropdown",16),m("selectedChange",function(r){return d(s),c(t.onSortChange(r))}),o(26,"div",13),F(27,"Sort By"),l()(),o(28,"ng-icon",17),m("click",function(){return d(s),c(t.onOrderChange())}),l()()(),o(29,"div",6)(30,"div",18),m("click",function(){return d(s),c(t.onReload())}),_(31,"ng-icon",19),l(),o(32,"finding-status",20),m("statusChange",function(r){return d(s),c(t.onMarkAs(r))}),l()()(),o(33,"list-finding",21),m("selectFindings",function(r){return d(s),c(t.selectFindingsChange(r))})("openFinding",function(r){return d(s),c(t.onOpenFinding(r))}),l(),o(34,"pagination",22),m("pageChange",function(r){return d(s),c(t.onPageChange(r))}),l()(),o(35,"div",23),v(36,_e,1,2,"finding-detail",24)(37,we,3,1,"div",25),l()()}if(n&2){let s=y(13),a=y(18),r=y(23);g(8),D("ngModel",t.store.filter.name),g(),p("showSearch",!0)("showMaxOption",1)("options",t.store.commits())("selected",t.store.filter.commitId)("optionTemplate",s),g(5),p("showSearch",!1)("showMaxOption",1)("options",t.statusOptions)("selected",t.store.filter.status)("optionTemplate",a),g(5),p("showSearch",!1)("showMaxOption",1)("options",t.store.scanners())("selected",t.store.filter.scanner)("optionTemplate",r),g(6),p("options",t.sortOptions)("showSearch",!1)("selected",t.store.filter.sortBy),g(3),p("name",t.store.filter.desc?"desc":"asc"),g(4),p("fixedLabel","Mark as"),g(),p("loading",t.store.loading())("findings",t.store.findings()),g(),p("currentPage",t.store.currentPage())("totalPage",t.store.totalPage()),g(2),V(t.finding!=null?36:37)}},dependencies:[se,U,Z,re,de,q,X,Q,G,K,J,ae,oe,ne]})}return i})();export{Ge as FindingComponent};
